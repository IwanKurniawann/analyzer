name: Crypto Trading Signal Analyzer

on:
push:
branches: [ main ]
schedule:
# Menjalankan setiap jam untuk menghemat kuota API
- cron: '0 * * * *'
workflow_dispatch: # Memungkinkan eksekusi manual

jobs:
run-analyzer:
runs-on: ubuntu-latest

steps:
- name: Checkout repository
  uses: actions/checkout@v4

- name: Set up Python
  id: setup-python
  uses: actions/setup-python@v5
  with:
    python-version: '3.11' # Versi Python yang stabil dan kompatibel

- name: Cache pip dependencies
  uses: actions/cache@v4
  with:
    # Lokasi direktori cache untuk pip
    path: ~/.cache/pip
    # Kunci unik untuk cache. Cache baru akan dibuat jika requirements.txt berubah.
    key: ${{ runner.os }}-python-${{ steps.setup-python.outputs.python-version }}-pip-${{ hashFiles('**/requirements.txt') }}
    restore-keys: |
      ${{ runner.os }}-python-${{ steps.setup-python.outputs.python-version }}-pip-

- name: Install dependencies
  run: |
    python -m pip install --upgrade pip
    pip install -r requirements.txt

- name: Run Python Analyzer Script
  env:
    TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
    TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
    GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
  run: python main.py
